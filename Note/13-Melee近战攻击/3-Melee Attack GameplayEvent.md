# Melee Attack Gameplay Event（近战攻击事件）





# Melee Impact Gameplay Cue

> 在Unreal Engine中，特别是对于多人游戏开发，GameplayCue是一种非常强大的功能，它允许开发者在游戏逻辑中通过统一的接口触发各种效果，包括但不限于粒子特效、声音、动画变化等，而无需直接从客户端发送指令去生成服务端的特效。在解决多人游戏模式下客户端不能正常生成服务端的攻击特效这类问题时，GameplayCue 可以通过以下几个方面发挥作用：
>
> 1. **同步机制**：
>    - GameplayCue的触发是基于游戏逻辑和规则的，这些规则在服务器端计算并决定何时触发。当服务器检测到一个攻击事件发生时，它会广播一条包含GameplayCue信息的消息给所有客户端。
>    - 客户端接收到这些GameplayCue消息后，会在本地正确地、一致地生成相应的特效，这样保证了所有玩家看到的效果都是基于服务器权威数据生成的。
> 2. **客户端预测与回滚**：
>    - Unreal Engine支持客户端预测，在客户端预测发起攻击动作时，也会先在本地模拟触发GameplayCue，然后将动作结果发送至服务器验证。
>    - 如果服务器确认有效，则其他客户端也接受这一结果；如果无效，服务器会发送修正信息，客户端再据此回滚或重放正确的GameplayCue效果。
> 3. **组件化设计**：
>    - GameplayCues被设计成可配置的组件，这意味着攻击特效可以作为独立的数据存储在游戏资产中，而不是硬编码在客户端或服务端代码里。
>    - 这样做的好处在于，服务器只需发送一个cue标识符，客户端就可以根据这个标识符找到对应的特效资源，并在正确时机播放。
>
> 举例来说，在一个多人游戏中，当一个玩家在服务器上对另一个玩家造成伤害时，服务器会触发一个带有攻击特效GameplayCue的事件。这个事件会被打包进网络更新包，发送给所有客户端。客户端在接收到这个事件后，通过其内置的GameplayCue系统自动调用相应的特效播放逻辑，从而确保即使在网络延迟的情况下，每个玩家也能看到一致且由服务器授权的攻击特效。

在多人游戏中，如果我们在NPC攻击时，生成一个攻击特效，首先，我们的NPC攻击逻辑是通过行为树来进行攻击的，因为行为树是存在AIController，AIController是仅在我们的服务端存在，所以由行为树生成的一系列事件（音效生成，特效生成），如果没有特殊处理，是只会表现在服务端的。

GAS为这种情况，有一个专门的处理方式，使用功能GampleyCue

![image-20240423120323938](.\image-20240423120323938.png)

首先，基于gameplayCueNotify_Static创建一个蓝图（因为我们不悔实例化GameplayCue的对象，所以用这个静态版本的Cue就行）

在GamplayCue蓝图中，我们重载On Execute函数，然后拆分出Parameters（参数列表），这里面有我们想处理的参数。

1：音效

![image-20240423122127925](.\image-20240423122127925.png)

2：粒子特效

![image-20240423122208100](.\image-20240423122208100.png)

3：一切装备就绪之后，需要我们设置gameplayCue，这是一个GameplayCue开头的标签，需要我们实现准备好，如下

![image-20240423121840658](.\image-20240423121840658.png)

4：指定Cue标签

![image-20240423122820772](.\image-20240423122820772.png)

5：回到我们的GA（技能释放处），原先我们是直接在造成伤害的时候，就播放音效，播放攻击特效等，现在，我们要先执行GameplayCue。如下

![image-20240423123422098](.\image-20240423123422098.png)

客户端显示内容

![image-20240423124019091](.\image-20240423124019091.png)
